<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
   PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
   "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
   
   
<!-- 상품목록의 섬네일이미지는 게시물DAO쪽에서 관리중 -->
<mapper namespace="com.product.mapper.IProductImgMapper">
	<insert id="insertImg"
		parameterType="com.product.dto.ProductImgDTO">
		INSERT INTO product_img
			(prodimg_id, filename, idx, main_idx, prod_id)	
		VALUES
			(seq_productimg_id.nextval, #{filename} ,#{idx} , #{main_idx} ,#{prod_id})
	</insert>
	
	<!-- 이거 메인인덱스로 역정렬하면 메인을 항상 첫번째로 오게 할 수 있음
	jsp에서 분배하는 방식은 고민좀 해봐야되겠지만 쿼리를 한번만 해도 된다는 
	장점이 있을듯 -->
	<select id="selectImg"
		parameterType="Long"
		resultType="com.product.dto.ProductImgDTO">
		SELECT prodimg_id, filename, idx, main_idx, prod_id
			FROM product_img 
				WHERE prod_id = #{prod_id}
					ORDER BY main_idx DESC, idx ASC
	</select>
	
	
	<select id="selectAllImg"
		parameterType="Long"
		resultType="com.product.dto.ProductImgDTO">
		SELECT prodimg_id, filename, idx, main_idx, prod_id
			FROM product_img 
				WHERE prod_id = #{prod_id}
					ORDER BY main_idx DESC, idx ASC
	</select>
	
	<update id="makeZero"
		parameterType="Long">
		UPDATE product_img SET
			main_idx = 0
			WHERE prod_id = #{prod_id}
	</update>
	<update id="updateMainImg"
		parameterType="Long">
		UPDATE product_img SET
			main_idx = 1
			WHERE prod_id = #{prod_id} AND idx=#{main_idx}
	</update>
	
	
	
	<select id="selectFilename"
		parameterType="Long">
		SELECT filename FROM product_img
		WHERE prod_id = #{prod_id} AND idx=#{idx}
	</select>
	<select id="selectAllFilenames"
		parameterType="Long">
		SELECT filename FROM product_img
		WHERE prod_id = #{prod_id}
	</select>
	<delete id="deleteImg"
		parameterType="Long">
		DELETE FROM product_img 
			WHERE prod_id = #{prod_id} and idx = #{idx}	
	</delete>
	<delete id="deleteAllImg"
		parameterType="Long">
		DELETE FROM product_img WHERE prod_id = #{prod_id}	
	</delete>
</mapper>